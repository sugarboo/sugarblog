(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{427:function(t,p,a){"use strict";a.r(p);var s=a(2),e=Object(s.a)({},(function(){var t=this,p=t._self._c;return p("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[p("blockquote",[p("p",[t._v("原文地址："),p("a",{attrs:{href:"https://juejin.cn/post/7201521440612974649",target:"_blank",rel:"noopener noreferrer"}},[t._v(" 如何自动打开你的 App？ - 掘金 "),p("OutboundLink")],1)])]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e49bcdaf475240b7b548d249dc489a06~tplv-k3u1fbpfcp-zoom-crop-mark:3024:3024:3024:1702.awebp?",alt:""}})]),t._v(" "),p("h2",{attrs:{id:"url-scheme"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#url-scheme"}},[t._v("#")]),t._v(" URL Scheme")]),t._v(" "),p("p",[t._v("首先是最原始的方式 URL Scheme。")]),t._v(" "),p("blockquote",[p("p",[t._v("URL Scheme 是一种特殊的 URL，用于定位到某个应用以及应用的某个功能。")])]),t._v(" "),p("p",[t._v("它的格式一般是： "),p("code",[t._v("[scheme:][//authority][path][?query]")])]),t._v(" "),p("p",[t._v("scheme 代表要打开的应用，每个上架应用商店的 App 所注册的 scheme 都是唯一的；后面的参数代表应用下的某个功能及其参数。")]),t._v(" "),p("h3",{attrs:{id:"在-ios-上配置-url-scheme"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#在-ios-上配置-url-scheme"}},[t._v("#")]),t._v(" 在 IOS 上配置 URL Scheme")]),t._v(" "),p("p",[t._v("在 XCode 里可以轻松配置")]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d26069a9c9d4489681e0a9ba317aa0a4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("h3",{attrs:{id:"在-android-上配置-url-scheme"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#在-android-上配置-url-scheme"}},[t._v("#")]),t._v(" 在 Android 上配置 URL Scheme")]),t._v(" "),p("p",[t._v("Android 的配置也很简单，在 AndroidManifest.xml 文件下添加以下配置即可")]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/feecdd536f814378bc0020813224097d~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("h3",{attrs:{id:"通过访问链接自动打开-app"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#通过访问链接自动打开-app"}},[t._v("#")]),t._v(" 通过访问链接自动打开 App")]),t._v(" "),p("p",[t._v("配置完成后，只要访问 URL Scheme 链接，系统便会自动打开对应 scheme 的 App。")]),t._v(" "),p("p",[t._v("因此，我们可以实现一个简单的 H5 页面来承载这个跳转逻辑，然后在页面中通过调用 "),p("code",[t._v("location.href=schemeUrl 或者 <a href='schemeUrl' />")]),t._v(" 等方式来触发访问链接，从而自动打开 App")]),t._v(" "),p("h3",{attrs:{id:"优缺点分析"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#优缺点分析"}},[t._v("#")]),t._v(" 优缺点分析")]),t._v(" "),p("p",[t._v("优点： 这个是最原始的方案，因此最大的优点就是兼容性好")]),t._v(" "),p("p",[t._v("缺点：")]),t._v(" "),p("ol",[p("li",[t._v("通过 scheme url 这种方式唤起 App，对于 H5 中间页面是无法感知的，并不知道是否已经成功打开 App")]),t._v(" "),p("li",[t._v("部分浏览器有安全限制，自动跳转会被拦截，必须用户手动触发跳转（即 location.href 行不通，必须 a 标签）")]),t._v(" "),p("li",[t._v("一些 App 会限制可访问的 scheme，你必须要在白名单内，否则也会被拦截跳转")]),t._v(" "),p("li",[t._v("通过 scheme url 唤起 App 时，浏览器会提示你是否确定要打开该 App，会影响用户体验")])]),t._v(" "),p("h2",{attrs:{id:"deeplink"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#deeplink"}},[t._v("#")]),t._v(" DeepLink")]),t._v(" "),p("p",[t._v("通过上述缺点我们可以看出，传统的 URL Scheme 在用户体验上是存在一定缺陷的。")]),t._v(" "),p("p",[t._v("因此，DeepLink 诞生了。")]),t._v(" "),p("p",[t._v("DeepLink 的宗旨就是通过传统的 HTT P链接就可以唤醒app，而如果用户没有安装APP，则会跳转到该链接对应的页面。")]),t._v(" "),p("h3",{attrs:{id:"ios-universal-link"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#ios-universal-link"}},[t._v("#")]),t._v(" IOS Universal Link")]),t._v(" "),p("p",[t._v("在 IOS 上一般称之为 Universal Link。")]),t._v(" "),p("p",[p("strong",[t._v("【配置你的 Universal Link 域名】")])]),t._v(" "),p("p",[t._v("首先要去 Apple 的开发者平台上配置你的 domains，假设是： "),p("code",[t._v("mysite.com")])]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e664df28ce5442794bc86f5975ed3f1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("p",[p("strong",[t._v("【配置 apple-app-site-association 文件】")])]),t._v(" "),p("p",[t._v("在该域名根目录下创建一个 .well-known 路径，并在该路径下放置 apple-app-site-association 文件。")]),t._v(" "),p("p",[t._v("文件内容包含 appID 以及 path，path如果配置 /app 则表示访问该域名下的 /app 路径均能唤起App")]),t._v(" "),p("p",[t._v("该文件内容大致如下：")]),t._v(" "),p("div",{staticClass:"language-json line-numbers-mode"},[p("pre",{pre:!0,attrs:{class:"language-json"}},[p("code",[p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),p("span",{pre:!0,attrs:{class:"token property"}},[t._v('"applinks"')]),p("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),p("span",{pre:!0,attrs:{class:"token property"}},[t._v('"apps"')]),p("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),p("span",{pre:!0,attrs:{class:"token property"}},[t._v('"details"')]),p("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n      "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),p("span",{pre:!0,attrs:{class:"token property"}},[t._v('"appID"')]),p("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token string"}},[t._v('"xxx"')]),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 你的应用的 appID")]),t._v("\n        "),p("span",{pre:!0,attrs:{class:"token property"}},[t._v('"paths"')]),p("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v(" "),p("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/app/*"')]),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),p("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])]),t._v(" "),p("div",{staticClass:"line-numbers-wrapper"},[p("span",{staticClass:"line-number"},[t._v("1")]),p("br"),p("span",{staticClass:"line-number"},[t._v("2")]),p("br"),p("span",{staticClass:"line-number"},[t._v("3")]),p("br"),p("span",{staticClass:"line-number"},[t._v("4")]),p("br"),p("span",{staticClass:"line-number"},[t._v("5")]),p("br"),p("span",{staticClass:"line-number"},[t._v("6")]),p("br"),p("span",{staticClass:"line-number"},[t._v("7")]),p("br"),p("span",{staticClass:"line-number"},[t._v("8")]),p("br"),p("span",{staticClass:"line-number"},[t._v("9")]),p("br"),p("span",{staticClass:"line-number"},[t._v("10")]),p("br"),p("span",{staticClass:"line-number"},[t._v("11")]),p("br"),p("span",{staticClass:"line-number"},[t._v("12")]),p("br")])]),p("p",[p("strong",[t._v("【系统获取配置文件】")])]),t._v(" "),p("p",[t._v("上面两步配置成功后，当用户 首次安装App 或者后续每次 覆盖安装App 时，系统都会主动去拉取域名下的配置文件。")]),t._v(" "),p("blockquote",[p("p",[t._v("即系统会主动去拉取 "),p("code",[t._v("https://mysite.com/.well-known/apple-app-site-association")]),t._v(" 这个文件")])]),t._v(" "),p("p",[t._v("然后根据返回的 appID 以及 path 判断访问哪些路径是需要唤起哪个App")]),t._v(" "),p("p",[p("strong",[t._v("【自动唤起 App】")])]),t._v(" "),p("p",[t._v("当系统成功获取配置文件后，只要用户访问 "),p("a",{attrs:{href:"https%3A%2F%2Fmysite.com%2Fapp%2Fxxx"}},[t._v("mysite.com/app/xxx")]),t._v(" 链接，系统便会自动唤起你的 App。")]),t._v(" "),p("p",[t._v("同时，客户端还可以进行一些自定义逻辑处理：")]),t._v(" "),p("p",[t._v("客户端会接收到 NSUserActivity 对象，其 actionType 为 NSUserActivityTypeBrowsingWeb，因此客户端可以在接收到该对象后做一些跳转逻辑处理。")]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d4cb8b8aa85c49489691ec0098fd87fe~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("h3",{attrs:{id:"android-deeplink"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#android-deeplink"}},[t._v("#")]),t._v(" Android DeepLink")]),t._v(" "),p("p",[t._v("与 IOS Universal Link 原理相似，Android系统也能够直接通过网站地址打开应用程序对应的内容页面，而不需要用户选择使用哪个应用来处理网站地址")]),t._v(" "),p("p",[p("strong",[t._v("【配置 AndroidManifest.xml】")]),t._v("\n在 AndroidManifest 配置文件中添加对应域名的 intent-filter：")]),t._v(" "),p("p",[t._v("scheme 为 https / http；")]),t._v(" "),p("p",[t._v("host 则是你的域名，假设是： "),p("code",[t._v("mysite.com")])]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a76712a1193142e0bb1841a297dc82c0~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("p",[p("strong",[t._v("【生成 assetlinks.json 文件】")])]),t._v(" "),p("p",[t._v("首先要去 Google "),p("a",{attrs:{href:"https://developer.android.com/studio/write/app-link-indexing?hl=zh-cn",target:"_blank",rel:"noopener noreferrer"}},[t._v("developers.google.com/digital-ass…"),p("OutboundLink")],1),t._v(" 生成你的 assetlinks json 文件。")]),t._v(" "),p("p",[p("img",{attrs:{src:"https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/78e681e022114919b4b40a64daaaa65f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),t._v(" "),p("p",[p("strong",[t._v("【配置 assetlinks.json 文件】")])]),t._v(" "),p("p",[t._v("生成文件后，同样的需要在该域名根目录下创建一个 .well-known 路径，并在该路径下放置 assetlinks.json 配置文件，文件内容包含应用的package name 和对应签名的sha哈希")]),t._v(" "),p("p",[p("strong",[t._v("【系统获取配置文件】")])]),t._v(" "),p("p",[t._v("配置成功后，当用户 首次安装App 或者后续每次 覆盖安装App 时，系统会进行以下校验：")]),t._v(" "),p("ol",[p("li",[t._v("如果 intent-filter 的 autoVerify 设置为 true，那么系统会验证其")])]),t._v(" "),p("ul",[p("li",[t._v("Action 是否为 android.intent.action.VIEW")]),t._v(" "),p("li",[t._v("Category 是否为android.intent.category.BROWSABLE 和 android.intent.category.DEFAULT")]),t._v(" "),p("li",[t._v("Data scheme 是否为 http 或 https")])]),t._v(" "),p("ol",[p("li",[t._v("如果上述条件都满足，那么系统将会拉取该域名下的 json 配置文件，同时将 App 设置为该域名链接的默认处理App")])]),t._v(" "),p("p",[p("strong",[t._v("【自动唤起 App】")])]),t._v(" "),p("p",[t._v("当系统成功获取配置文件后，只要用户访问 "),p("a",{attrs:{href:"https%3A%2F%2Fmysite.com%2Fapp%2Fxxx"}},[t._v("mysite.com/app/xxx")]),t._v(" 链接，系统便会自动唤起你的 App。")]),t._v(" "),p("h3",{attrs:{id:"优缺点分析-2"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#优缺点分析-2"}},[t._v("#")]),t._v(" 优缺点分析")]),t._v(" "),p("p",[p("strong",[t._v("【优点】")])]),t._v(" "),p("ol",[p("li",[t._v("用户体验好：可以直接打开 App，没有弹窗提示")]),t._v(" "),p("li",[t._v("唤起App失败则会跳转链接对应的页面")])]),t._v(" "),p("p",[p("strong",[t._v("【缺点】")])]),t._v(" "),p("ol",[p("li",[t._v("iOS 9 以后才支持 Universal Link，")]),t._v(" "),p("li",[t._v("Android 6.0 以后才支持 DeepLink")]),t._v(" "),p("li",[t._v("DeepLink 需要依赖远程配置文件，无法保证每次都能成功拉取到配置文件")])]),t._v(" "),p("h2",{attrs:{id:"推荐方案-deeplink-h5-兜底"}},[p("a",{staticClass:"header-anchor",attrs:{href:"#推荐方案-deeplink-h5-兜底"}},[t._v("#")]),t._v(" 推荐方案： DeepLink + H5 兜底")]),t._v(" "),p("p",[t._v("基于前面两种方案的优缺点，我推荐的解决方案是配置 DeepLink，同时再加上一个 H5 页面作为兜底。")]),t._v(" "),p("p",[t._v("首先按照前面 DeepLink 的教程先配置好 DeepLink，其中访问路径配置为 "),p("code",[t._v("https://mysite.com/app")])]),t._v(" "),p("p",[t._v("接着，我们就可以在 "),p("code",[t._v("https://mysite.com/app")]),t._v(" 路径下做文章了。在该路径下放置一个 H5 页面，内容可以是引导用户打开你的 App。")]),t._v(" "),p("p",[t._v("当用户访问 DeepLink 没有自动打开你的 App 时，此时用户会进入浏览器，并访问  "),p("code",[t._v("https://mysite.com/app")]),t._v(" 这个 H5 页面。")]),t._v(" "),p("p",[t._v("在 H5 页面中，你可以通过浏览器 ua 获取当前的系统以及版本：")]),t._v(" "),p("ol",[p("li",[t._v("如果是 Android 6.0 以下，那么可以尝试用 URL Scheme 去唤起 App")]),t._v(" "),p("li",[t._v("如果是 IOS / Android 6.0 及以上，那么此时可以判断用户未安装 App。这种情况下可以做些额外的逻辑，比如重定向到应用商店引导用户去下载之类的")])])])}),[],!1,null,null,null);p.default=e.exports}}]);